<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Review - MangroveTour</title>
    <link rel="stylesheet" href="assets/css/bootstrap-5.3.8-dist/bootstrap.css">
    <link rel="stylesheet" href="assets/css/bootstrap-icons-1.13.1/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top shadow-sm">
        <div class="container-fluid px-4">
            <a class="navbar-brand fw-bold" href="index.html" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;"><i class="bi bi-leaf" style="color: var(--primary-green);"></i> MangroveTour</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="index.html#about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="booking.html">Book Ticket</a></li>
                    <li class="nav-item"><a class="nav-link active" href="index.html#reviews">Reviews</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Visitor Status Bar -->
    <div style="background: #f8f9fa; border-bottom: 2px solid #e9ecef; padding: 10px 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 14px; color: #333;">
                    <span id="visitorStatus">
                        <i class="bi bi-person"></i> 
                        <span>Not logged in</span>
                        <a href="backend/auth/visitor-login.php" style="margin-left: 10px; color: var(--primary-green); text-decoration: none; font-weight: 500;">Login</a>
                        <span style="margin: 0 5px; color: #999;">â€¢</span>
                        <a href="backend/auth/visitor-register.html" style="color: var(--primary-green); text-decoration: none; font-weight: 500;">Register</a>
                    </span>
                </div>
                <div id="logoutContainer" style="display: none;">
                    <a href="../backend/auth/visitor-logout.php" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-box-arrow-right"></i> Logout
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container py-5">
        <h1 class="mb-4" style="color: #2d5016;"><i class="bi bi-star"></i> Share Your Experience</h1>

        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card">
                    <div class="card-header">
                        <h5 style="margin: 0;">Submit Your Review</h5>
                    </div>
                    <div class="card-body">
                        <p style="color: #666; font-size: 14px;">We'd love to hear about your experience at Mangrove Wonorejo. Your feedback helps us improve our services and helps other visitors make informed decisions.</p>

                        <form id="reviewForm">
                            <div class="mb-3">
                                <label for="id_pengunjung" class="form-label">Visitor ID *</label>
                                <input type="number" class="form-control" id="id_pengunjung" name="id_pengunjung" placeholder="Your Visitor ID" required readonly>
                                <small class="form-text text-muted">Automatically filled when you login</small>
                            </div>

                            <div class="mb-3">
                                <label for="rating" class="form-label">Rating *</label>
                                <div class="rating-selector">
                                    <div class="btn-group w-100" role="group">
                                        <input type="radio" class="btn-check" name="rating" id="rating1" value="1">
                                        <label class="btn btn-outline-secondary" for="rating1"><i class="bi bi-star-fill"></i> 1 Star</label>

                                        <input type="radio" class="btn-check" name="rating" id="rating2" value="2">
                                        <label class="btn btn-outline-secondary" for="rating2"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i> 2 Stars</label>

                                        <input type="radio" class="btn-check" name="rating" id="rating3" value="3">
                                        <label class="btn btn-outline-secondary" for="rating3"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i> 3 Stars</label>

                                        <input type="radio" class="btn-check" name="rating" id="rating4" value="4">
                                        <label class="btn btn-outline-secondary" for="rating4"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i> 4 Stars</label>

                                        <input type="radio" class="btn-check" name="rating" id="rating5" value="5">
                                        <label class="btn btn-outline-secondary" for="rating5"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i> 5 Stars</label>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="komentar" class="form-label">Your Comment *</label>
                                <textarea class="form-control" id="komentar" name="komentar" rows="5" placeholder="Share your experience, what you enjoyed, and suggestions for improvement..." required></textarea>
                            </div>

                            <div class="alert alert-info">
                                <p style="margin: 0; font-size: 14px;">
                                    <i class="bi bi-info-circle"></i> Your review will be published on our website and help other travelers.
                                </p>
                            </div>

                            <button type="submit" class="btn btn-eco btn-lg w-100">
                                <i class="bi bi-check-circle"></i> Submit Review
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="background: #2d5016; color: white; padding: 40px 0 20px; margin-top: 50px;">
        <div class="container text-center">
            <p>&copy; 2025 MangroveTour - Mangrove Wonorejo Ecotourism. All rights reserved.</p>
            <p style="font-size: 12px; color: #8db58d;">Preserving nature, one visit at a time.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Check visitor session on page load
        async function checkVisitorSession() {
            try {
                const response = await fetch('/pweb-project/backend/api/visitor-status.php');
                const data = await response.json();
                
                if (data.logged_in) {
                    const statusSpan = document.getElementById('visitorStatus');
                    statusSpan.innerHTML = `
                        <i class="bi bi-person-check"></i>
                        <strong>${data.nama}</strong> (ID: ${data.id_pengunjung})
                    `;
                    
                    document.getElementById('logoutContainer').style.display = 'block';
                    
                    // Auto-fill visitor ID
                    document.getElementById('id_pengunjung').value = data.id_pengunjung;
                } else {
                    // Redirect to login if not logged in
                    alert('Please login to submit a review');
                    window.location.href = '/pweb-project/backend/auth/visitor-login.php?redirect=' + encodeURIComponent(window.location.href);
                }
            } catch (error) {
                console.log('Error checking session:', error);
            }
        }

        // Check session on page load
        document.addEventListener('DOMContentLoaded', checkVisitorSession);

        document.getElementById('reviewForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                id_pengunjung: parseInt(document.getElementById('id_pengunjung').value),
                rating: parseInt(document.querySelector('input[name="rating"]:checked').value),
                komentar: document.getElementById('komentar').value
            };

            try {
                const response = await fetch('/pweb-project/backend/api/review.php?action=create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success) {
                    alert('Thank you for your review! It has been submitted successfully.');
                    document.getElementById('reviewForm').reset();
                    document.getElementById('rating5').checked = true;
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                alert('Error submitting review: ' + error.message);
            }
        });
    </script>
</body>
</html>
